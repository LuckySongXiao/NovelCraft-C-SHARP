<UserControl x:Class="NovelManagement.WPF.Views.AICollaborationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             TextElement.Foreground="{DynamicResource MaterialDesignBody}"
             TextElement.FontWeight="Regular"
             TextElement.FontSize="13"
             TextOptions.TextFormattingMode="Ideal"
             TextOptions.TextRenderingMode="Auto"
             Background="{DynamicResource MaterialDesignPaper}"
             FontFamily="{DynamicResource MaterialDesignFont}">
    
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 页面标题 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="AI协作创作" 
                     FontSize="32" 
                     FontWeight="Bold" 
                     Margin="0,0,0,8"/>
            <TextBlock Text="管理AI Agent协作、监控工作流程和任务队列" 
                     FontSize="16" 
                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
        </StackPanel>

        <!-- 主要内容区域 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧面板 - Agent状态监控 -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Agent状态监控标题 -->
                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Robot" 
                                               VerticalAlignment="Center" 
                                               Width="24" Height="24" 
                                               Margin="0,0,8,0"/>
                        <TextBlock Text="Agent状态监控" 
                                 FontSize="18" 
                                 FontWeight="Medium" 
                                 VerticalAlignment="Center"/>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="刷新Agent状态"
                              Margin="8,0,0,0"
                              Click="RefreshAgents_Click">
                            <materialDesign:PackIcon Kind="Refresh"/>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Agent列表 -->
                <materialDesign:Card Grid.Row="1" Padding="0">
                    <ListView x:Name="AgentListView" 
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="16,12" 
                                      BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                      BorderThickness="0,0,0,1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Agent图标 -->
                                        <materialDesign:PackIcon Grid.Column="0" 
                                                               Kind="{Binding IconKind}" 
                                                               Width="32" Height="32" 
                                                               VerticalAlignment="Center"
                                                               Foreground="{Binding StatusColor}"/>

                                        <!-- Agent信息 -->
                                        <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                            <TextBlock Text="{Binding Name}" 
                                                     FontWeight="Medium" 
                                                     FontSize="14"/>
                                            <TextBlock Text="{Binding StatusDescription}" 
                                                     FontSize="12" 
                                                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            <TextBlock Text="{Binding CurrentTask}" 
                                                     FontSize="11" 
                                                     Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                     Visibility="{Binding HasCurrentTask, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            
                                            <!-- 进度条 -->
                                            <ProgressBar Value="{Binding Progress}" 
                                                       Maximum="100" 
                                                       Height="4" 
                                                       Margin="0,4,0,0"
                                                       Visibility="{Binding IsWorking, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </StackPanel>

                                        <!-- 操作按钮 -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="查看详情"
                                                  Click="ViewAgentDetails_Click"
                                                  Tag="{Binding}">
                                                <materialDesign:PackIcon Kind="Information"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="重置Agent"
                                                  Click="ResetAgent_Click"
                                                  Tag="{Binding}">
                                                <materialDesign:PackIcon Kind="Restart"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </materialDesign:Card>

                <!-- 工作流控制面板标题 -->
                <materialDesign:Card Grid.Row="3" Padding="16" Margin="0,8,0,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Workflow" 
                                               VerticalAlignment="Center" 
                                               Width="24" Height="24" 
                                               Margin="0,0,8,0"/>
                        <TextBlock Text="工作流控制" 
                                 FontSize="18" 
                                 FontWeight="Medium" 
                                 VerticalAlignment="Center"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 工作流控制按钮 -->
                <materialDesign:Card Grid.Row="4" Padding="16">
                    <StackPanel>
                        <Button Content="创建项目初始化工作流" 
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              Margin="0,0,0,8"
                              Click="CreateProjectInitWorkflow_Click"/>
                        <Button Content="创建章节创建工作流" 
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              Margin="0,0,0,8"
                              Click="CreateChapterWorkflow_Click"/>
                        <Button Content="创建内容审查工作流" 
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              Margin="0,0,0,8"
                              Click="CreateReviewWorkflow_Click"/>
                        <Button Content="创建一致性检查工作流" 
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              Margin="0,0,0,0"
                              Click="CreateConsistencyWorkflow_Click"/>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>

            <!-- 分隔符 -->
            <GridSplitter Grid.Column="1"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Background="{DynamicResource MaterialDesignDivider}"/>

            <!-- 中间面板 - DeepSeek API配置和思维链控制 -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- AI模型配置标题 -->
                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Robot"
                                               VerticalAlignment="Center"
                                               Width="24" Height="24"
                                               Margin="0,0,8,0"/>
                        <TextBlock Text="AI模型配置"
                                 FontSize="18"
                                 FontWeight="Medium"
                                 VerticalAlignment="Center"/>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="打开配置窗口"
                              Margin="8,0,0,0"
                              Click="OpenConfigWindow_Click">
                            <materialDesign:PackIcon Kind="Settings"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="测试连接"
                              Margin="4,0,0,0"
                              Click="TestConnection_Click">
                            <materialDesign:PackIcon Kind="TestTube"/>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- AI模型配置面板 -->
                <materialDesign:Card Grid.Row="1" Padding="16">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- 提供者选择 -->
                            <ComboBox x:Name="ProviderComboBox"
                                    materialDesign:HintAssist.Hint="AI提供者"
                                    Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                    SelectionChanged="ProviderComboBox_SelectionChanged"
                                    Margin="0,0,0,16">
                                <ComboBoxItem Content="Ollama (本地模型)" Tag="Ollama" IsSelected="True"/>
                                <ComboBoxItem Content="DeepSeek (云端模型)" Tag="DeepSeek"/>
                                <ComboBoxItem Content="MCP (协议模型)" Tag="MCP"/>
                            </ComboBox>

                            <!-- 模型选择 -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <ComboBox x:Name="ModelComboBox"
                                        Grid.Column="0"
                                        materialDesign:HintAssist.Hint="选择模型"
                                        Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                        Margin="0,0,8,0"/>

                                <Button x:Name="RefreshModelsButton"
                                      Grid.Column="1"
                                      Style="{StaticResource MaterialDesignIconButton}"
                                      ToolTip="刷新模型列表"
                                      Click="RefreshModels_Click">
                                    <materialDesign:PackIcon Kind="Refresh"/>
                                </Button>
                            </Grid>

                            <!-- 连接状态 -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <materialDesign:PackIcon x:Name="ConnectionStatusIcon"
                                                       Grid.Column="0"
                                                       Kind="Circle"
                                                       VerticalAlignment="Center"
                                                       Foreground="Orange"
                                                       Margin="0,0,8,0"/>

                                <TextBlock x:Name="ConnectionStatusText"
                                         Grid.Column="1"
                                         Text="检查中..."
                                         VerticalAlignment="Center"/>

                                <Button x:Name="RefreshConnectionButton"
                                      Grid.Column="2"
                                      Content="刷新"
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Click="RefreshConnection_Click"/>
                            </Grid>

                            <!-- 温度参数 -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Slider x:Name="TemperatureSlider"
                                      Grid.Column="0"
                                      Minimum="0" Maximum="2" Value="0.7"
                                      TickFrequency="0.1" IsSnapToTickEnabled="True"
                                      VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1"
                                         Text="{Binding Value, ElementName=TemperatureSlider, StringFormat=温度: {0:F1}}"
                                         VerticalAlignment="Center"
                                         Margin="8,0,0,0"/>
                            </Grid>

                            <!-- 最大令牌数 -->
                            <TextBox x:Name="MaxTokensTextBox"
                                   materialDesign:HintAssist.Hint="最大令牌数"
                                   Text="4000"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   Margin="0,0,0,16"/>

                            <!-- 启用思维链 -->
                            <CheckBox x:Name="EnableThinkingChainCheckBox"
                                    Content="启用思维链显示"
                                    IsChecked="True"
                                    Margin="0,0,0,16"/>

                            <!-- 启用流式响应 -->
                            <CheckBox x:Name="EnableStreamingCheckBox"
                                    Content="启用流式响应"
                                    IsChecked="True"
                                    Margin="0,0,0,16"/>

                            <!-- 快速测试区域 -->
                            <Expander Header="快速测试" Margin="0,16,0,0">
                                <StackPanel Margin="0,8,0,0">
                                    <TextBox x:Name="TestPromptTextBox"
                                           materialDesign:HintAssist.Hint="输入测试提示词"
                                           Text="你好，请介绍一下你自己。"
                                           Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                           AcceptsReturn="True"
                                           TextWrapping="Wrap"
                                           MinHeight="60"
                                           Margin="0,0,0,8"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <Button x:Name="SendTestButton"
                                              Grid.Column="0"
                                              Content="发送测试"
                                              Style="{StaticResource MaterialDesignRaisedButton}"
                                              Click="SendTest_Click"
                                              Margin="0,0,8,0"/>

                                        <CheckBox x:Name="StreamingTestCheckBox"
                                                Grid.Column="1"
                                                Content="流式响应"
                                                IsChecked="True"
                                                VerticalAlignment="Center"/>
                                    </Grid>

                                    <TextBox x:Name="TestResponseTextBox"
                                           materialDesign:HintAssist.Hint="AI响应将显示在这里"
                                           Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                           AcceptsReturn="True"
                                           TextWrapping="Wrap"
                                           IsReadOnly="True"
                                           MinHeight="120"
                                           Margin="0,8,0,0"/>
                                </StackPanel>
                            </Expander>

                            <!-- 保存配置按钮 -->
                            <Button Content="保存配置"
                                  Style="{StaticResource MaterialDesignRaisedButton}"
                                  Margin="0,16,0,0"
                                  Click="SaveConfiguration_Click"/>
                        </StackPanel>
                    </ScrollViewer>
                </materialDesign:Card>

                <!-- 思维链控制标题 -->
                <materialDesign:Card Grid.Row="3" Padding="16" Margin="0,8,0,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Brain"
                                               VerticalAlignment="Center"
                                               Width="24" Height="24"
                                               Margin="0,0,8,0"/>
                        <TextBlock Text="思维链控制"
                                 FontSize="18"
                                 FontWeight="Medium"
                                 VerticalAlignment="Center"/>
                        <TextBlock x:Name="ActiveThinkingChainsText"
                                 Text="(0 个活动窗口)"
                                 FontSize="12"
                                 Foreground="{DynamicResource MaterialDesignBodyLight}"
                                 VerticalAlignment="Center"
                                 Margin="8,0,0,0"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 思维链控制面板 -->
                <materialDesign:Card Grid.Row="4" Padding="16">
                    <StackPanel>
                        <!-- 悬浮窗口设置 -->
                        <TextBlock Text="悬浮窗口设置" FontWeight="Medium" Margin="0,0,0,8"/>

                        <!-- 透明度 -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="OpacitySlider"
                                  Grid.Column="0"
                                  Minimum="0.1" Maximum="1.0" Value="0.9"
                                  TickFrequency="0.1" IsSnapToTickEnabled="True"
                                  VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1"
                                     Text="{Binding Value, ElementName=OpacitySlider, StringFormat=透明度: {0:P0}}"
                                     VerticalAlignment="Center"
                                     Margin="8,0,0,0"/>
                        </Grid>

                        <!-- 默认位置 -->
                        <ComboBox x:Name="DefaultPositionComboBox"
                                materialDesign:HintAssist.Hint="默认位置"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                Margin="0,0,0,12">
                            <ComboBoxItem Content="右上角" Tag="TopRight" IsSelected="True"/>
                            <ComboBoxItem Content="左上角" Tag="TopLeft"/>
                            <ComboBoxItem Content="右下角" Tag="BottomRight"/>
                            <ComboBoxItem Content="左下角" Tag="BottomLeft"/>
                            <ComboBoxItem Content="中心" Tag="Center"/>
                        </ComboBox>

                        <!-- 最大窗口数 -->
                        <TextBox x:Name="MaxWindowsTextBox"
                               materialDesign:HintAssist.Hint="最大窗口数"
                               Text="3"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Margin="0,0,0,16"/>

                        <!-- 控制按钮 -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Content="隐藏所有"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"
                                  Margin="0,0,8,0"
                                  Click="HideAllThinkingChains_Click"/>
                            <Button Content="显示测试"
                                  Style="{StaticResource MaterialDesignRaisedButton}"
                                  Click="ShowTestThinkingChain_Click"/>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>

            <!-- 分隔符 -->
            <GridSplitter Grid.Column="3"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Background="{DynamicResource MaterialDesignDivider}"/>

            <!-- 右侧面板 - 任务队列、统计监控和日志 -->
            <Grid Grid.Column="4">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 任务队列标题 -->
                <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="FormatListBulleted" 
                                               VerticalAlignment="Center" 
                                               Width="24" Height="24" 
                                               Margin="0,0,8,0"/>
                        <TextBlock Text="任务队列" 
                                 FontSize="18" 
                                 FontWeight="Medium" 
                                 VerticalAlignment="Center"/>
                        <TextBlock x:Name="TaskQueueStatusText"
                                 Text="(0 待处理, 0 运行中, 0 已完成)" 
                                 FontSize="12" 
                                 Foreground="{DynamicResource MaterialDesignBodyLight}"
                                 VerticalAlignment="Center"
                                 Margin="8,0,0,0"/>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="清空队列"
                              Margin="8,0,0,0"
                              Click="ClearQueue_Click">
                            <materialDesign:PackIcon Kind="DeleteSweep"/>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 任务列表 -->
                <materialDesign:Card Grid.Row="1" Padding="0">
                    <ListView x:Name="TaskQueueListView" 
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="16,12" 
                                      BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                      BorderThickness="0,0,0,1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- 任务状态图标 -->
                                        <materialDesign:PackIcon Grid.Column="0" 
                                                               Kind="{Binding StatusIcon}" 
                                                               Width="24" Height="24" 
                                                               VerticalAlignment="Center"
                                                               Foreground="{Binding StatusColor}"/>

                                        <!-- 任务信息 -->
                                        <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                            <TextBlock Text="{Binding Name}" 
                                                     FontWeight="Medium" 
                                                     FontSize="14"/>
                                            <TextBlock Text="{Binding TaskType}" 
                                                     FontSize="12" 
                                                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            <TextBlock Text="{Binding TargetAgentId, StringFormat='目标Agent: {0}'}" 
                                                     FontSize="11" 
                                                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                            
                                            <!-- 进度条 -->
                                            <ProgressBar Value="{Binding Progress}" 
                                                       Maximum="100" 
                                                       Height="4" 
                                                       Margin="0,4,0,0"
                                                       Visibility="{Binding IsRunning, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </StackPanel>

                                        <!-- 操作按钮 -->
                                        <Button Grid.Column="2" 
                                              Style="{StaticResource MaterialDesignIconButton}"
                                              ToolTip="取消任务"
                                              Click="CancelTask_Click"
                                              Tag="{Binding}"
                                              Visibility="{Binding CanCancel, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <materialDesign:PackIcon Kind="Cancel"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </materialDesign:Card>

                <!-- 统计监控标题 -->
                <materialDesign:Card Grid.Row="3" Padding="16" Margin="0,8,0,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ChartLine"
                                               VerticalAlignment="Center"
                                               Width="24" Height="24"
                                               Margin="0,0,8,0"/>
                        <TextBlock Text="使用统计"
                                 FontSize="18"
                                 FontWeight="Medium"
                                 VerticalAlignment="Center"/>
                        <ComboBox x:Name="StatisticsTimeRangeComboBox"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                Width="120"
                                Margin="16,0,8,0"
                                SelectionChanged="StatisticsTimeRange_SelectionChanged">
                            <ComboBoxItem Content="今天" Tag="Today" IsSelected="True"/>
                            <ComboBoxItem Content="昨天" Tag="Yesterday"/>
                            <ComboBoxItem Content="本周" Tag="LastWeek"/>
                            <ComboBoxItem Content="本月" Tag="LastMonth"/>
                        </ComboBox>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="刷新统计"
                              Margin="0,0,8,0"
                              Click="RefreshStatistics_Click">
                            <materialDesign:PackIcon Kind="Refresh"/>
                        </Button>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="导出统计"
                              Click="ExportStatistics_Click">
                            <materialDesign:PackIcon Kind="Export"/>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 统计监控面板 -->
                <materialDesign:Card Grid.Row="4" Padding="16">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- 基础统计 -->
                            <TextBlock Text="基础统计" FontWeight="Medium" Margin="0,0,0,8"/>
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
                                    <TextBlock Text="总请求数" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <TextBlock x:Name="TotalRequestsText" Text="0" FontSize="18" FontWeight="Medium"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,8">
                                    <TextBlock Text="成功率" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <TextBlock x:Name="SuccessRateText" Text="0%" FontSize="18" FontWeight="Medium"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,8,8">
                                    <TextBlock Text="平均耗时" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <TextBlock x:Name="AverageTimeText" Text="0s" FontSize="18" FontWeight="Medium"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="1" Margin="8,0,0,8">
                                    <TextBlock Text="令牌使用" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <TextBlock x:Name="TokenUsageText" Text="0" FontSize="18" FontWeight="Medium"/>
                                </StackPanel>
                            </Grid>

                            <!-- 功能使用排行 -->
                            <TextBlock Text="功能使用排行" FontWeight="Medium" Margin="0,0,0,8"/>
                            <ListView x:Name="FunctionRankingListView"
                                    Height="120"
                                    Margin="0,0,0,16">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="功能" Width="100" DisplayMemberBinding="{Binding FunctionName}"/>
                                        <GridViewColumn Header="次数" Width="50" DisplayMemberBinding="{Binding UsageCount}"/>
                                        <GridViewColumn Header="成功率" Width="70" DisplayMemberBinding="{Binding SuccessRate, StringFormat={}{0:F1}%}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>

                            <!-- 最近错误 -->
                            <TextBlock Text="最近错误" FontWeight="Medium" Margin="0,0,0,8"/>
                            <ListView x:Name="RecentErrorsListView" Height="80">
                                <ListView.View>
                                    <GridView>
                                        <GridViewColumn Header="时间" Width="80" DisplayMemberBinding="{Binding Timestamp, StringFormat={}{0:HH:mm}}"/>
                                        <GridViewColumn Header="功能" Width="80" DisplayMemberBinding="{Binding FunctionName}"/>
                                        <GridViewColumn Header="错误" Width="120" DisplayMemberBinding="{Binding ErrorMessage}"/>
                                    </GridView>
                                </ListView.View>
                            </ListView>
                        </StackPanel>
                    </ScrollViewer>
                </materialDesign:Card>

                <!-- 交互日志标题 -->
                <materialDesign:Card Grid.Row="6" Padding="16" Margin="0,8,0,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="MessageText"
                                               VerticalAlignment="Center"
                                               Width="24" Height="24"
                                               Margin="0,0,8,0"/>
                        <TextBlock Text="Agent交互日志"
                                 FontSize="18"
                                 FontWeight="Medium"
                                 VerticalAlignment="Center"/>
                        <Button Style="{StaticResource MaterialDesignIconButton}"
                              ToolTip="清空日志"
                              Margin="8,0,0,0"
                              Click="ClearLog_Click">
                            <materialDesign:PackIcon Kind="Delete"/>
                        </Button>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 日志列表 -->
                <materialDesign:Card Grid.Row="7" Padding="8">
                    <ScrollViewer x:Name="LogScrollViewer"
                                VerticalScrollBarVisibility="Auto"
                                HorizontalScrollBarVisibility="Disabled">
                        <TextBlock x:Name="LogTextBlock"
                                 FontFamily="Consolas"
                                 FontSize="11"
                                 TextWrapping="Wrap"
                                 Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                    </ScrollViewer>
                </materialDesign:Card>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
