<Window x:Class="NovelManagement.WPF.Views.AIChapterWriteDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="AI章节编写" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题区域 -->
        <materialDesign:Card Grid.Row="0" Margin="0,0,0,16" Padding="16">
            <StackPanel>
                <DockPanel>
                    <TextBlock Text="AI章节编写"
                             FontSize="24"
                             FontWeight="Bold"
                             DockPanel.Dock="Left"/>
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                        <!-- AI模型选择 -->
                        <ComboBox x:Name="AIModelComboBox"
                                materialDesign:HintAssist.Hint="AI模型"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                Width="120"
                                Margin="0,0,8,0">
                            <ComboBoxItem Content="DeepSeek" IsSelected="True"/>
                            <ComboBoxItem Content="Ollama"/>
                            <ComboBoxItem Content="GPT-4"/>
                        </ComboBox>
                        <!-- 模板管理 -->
                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                              Click="ManageTemplates_Click"
                              ToolTip="管理生成模板">
                            <materialDesign:PackIcon Kind="FileDocument"/>
                        </Button>
                    </StackPanel>
                </DockPanel>

                <TextBlock Text="AI将根据章节信息、大纲、剧情设定等自动生成章节内容"
                         FontSize="14"
                         Foreground="{DynamicResource MaterialDesignBodyLight}"
                         Margin="0,8,0,0"/>

                <!-- 进度指示器 -->
                <ProgressBar x:Name="GenerationProgressBar"
                           Height="4"
                           Margin="0,12,0,0"
                           Visibility="Collapsed"
                           Style="{StaticResource MaterialDesignLinearProgressBar}"/>

                <!-- 状态显示 -->
                <TextBlock x:Name="StatusTextBlock"
                         Text=""
                         Style="{StaticResource MaterialDesignCaptionTextBlock}"
                         Margin="0,4,0,0"
                         Visibility="Collapsed"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- 主内容区域 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧：设置面板 -->
            <materialDesign:Card Grid.Column="0" Padding="16">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="生成设置" 
                                 FontSize="16" 
                                 FontWeight="Medium" 
                                 Margin="0,0,0,16"/>

                        <!-- 章节标题 -->
                        <TextBox x:Name="ChapterTitleTextBox"
                               materialDesign:HintAssist.Hint="章节标题"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Margin="0,0,0,12"/>

                        <!-- 写作风格 -->
                        <ComboBox x:Name="WritingStyleComboBox"
                                materialDesign:HintAssist.Hint="写作风格"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                Margin="0,0,0,12">
                            <ComboBoxItem Content="现代都市"/>
                            <ComboBoxItem Content="古风仙侠" IsSelected="True"/>
                            <ComboBoxItem Content="科幻未来"/>
                            <ComboBoxItem Content="奇幻魔法"/>
                            <ComboBoxItem Content="历史军事"/>
                            <ComboBoxItem Content="悬疑推理"/>
                        </ComboBox>

                        <!-- 章节类型 -->
                        <ComboBox x:Name="ChapterTypeComboBox"
                                materialDesign:HintAssist.Hint="章节类型"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                Margin="0,0,0,12">
                            <ComboBoxItem Content="正文章节" IsSelected="True"/>
                            <ComboBoxItem Content="过渡章节"/>
                            <ComboBoxItem Content="高潮章节"/>
                            <ComboBoxItem Content="回忆章节"/>
                            <ComboBoxItem Content="番外章节"/>
                        </ComboBox>

                        <!-- 目标字数 -->
                        <TextBox x:Name="TargetWordCountTextBox"
                               materialDesign:HintAssist.Hint="目标字数"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Text="2800"
                               Margin="0,0,0,12"/>

                        <!-- 章节大纲 -->
                        <TextBox x:Name="ChapterOutlineTextBox"
                               materialDesign:HintAssist.Hint="章节大纲（简要描述章节要点）"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               TextWrapping="Wrap"
                               AcceptsReturn="True"
                               MinHeight="80"
                               MaxHeight="120"
                               VerticalScrollBarVisibility="Auto"
                               Margin="0,0,0,12"/>

                        <!-- 关键情节 -->
                        <TextBox x:Name="KeyPlotsTextBox"
                               materialDesign:HintAssist.Hint="关键情节（必须包含的重要情节点）"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               TextWrapping="Wrap"
                               AcceptsReturn="True"
                               MinHeight="60"
                               MaxHeight="100"
                               VerticalScrollBarVisibility="Auto"
                               Margin="0,0,0,12"/>

                        <!-- 出场角色 -->
                        <TextBox x:Name="CharactersTextBox"
                               materialDesign:HintAssist.Hint="出场角色（用逗号分隔）"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Margin="0,0,0,12"/>

                        <!-- 高级设置 -->
                        <Expander Header="高级设置" Margin="0,0,0,12">
                            <StackPanel Margin="0,8,0,0">
                                <!-- 创意程度 -->
                                <TextBlock Text="创意程度" FontWeight="Medium" Margin="0,0,0,4"/>
                                <Slider x:Name="CreativitySlider"
                                      Minimum="0" Maximum="100" Value="70"
                                      TickFrequency="10" TickPlacement="BottomRight"
                                      Margin="0,0,0,8"/>
                                <TextBlock Text="{Binding ElementName=CreativitySlider, Path=Value, StringFormat='{}{0:F0}%'}"
                                         HorizontalAlignment="Center"
                                         FontSize="12"
                                         Margin="0,0,0,12"/>

                                <!-- 分段生成 -->
                                <CheckBox x:Name="SegmentedGenerationCheckBox"
                                        Content="分段生成（适合长章节）"
                                        Margin="0,0,0,8"/>

                                <!-- 实时预览 -->
                                <CheckBox x:Name="RealTimePreviewCheckBox"
                                        Content="实时预览生成过程"
                                        Margin="0,0,0,8"/>

                                <!-- 语言风格强度 -->
                                <TextBlock Text="语言风格强度" FontWeight="Medium" Margin="0,8,0,4"/>
                                <ComboBox x:Name="StyleIntensityComboBox"
                                        Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                        Margin="0,0,0,8">
                                    <ComboBoxItem Content="轻度"/>
                                    <ComboBoxItem Content="中度" IsSelected="True"/>
                                    <ComboBoxItem Content="强烈"/>
                                </ComboBox>
                            </StackPanel>
                        </Expander>

                        <!-- 特殊要求 -->
                        <TextBox x:Name="SpecialRequirementsTextBox"
                               materialDesign:HintAssist.Hint="特殊要求（如特定描写重点、情感基调等）"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               TextWrapping="Wrap"
                               AcceptsReturn="True"
                               MinHeight="60"
                               MaxHeight="100"
                               VerticalScrollBarVisibility="Auto"
                               Margin="0,0,0,16"/>

                        <!-- 生成按钮组 -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Button x:Name="GenerateButton"
                                  Grid.Column="0"
                                  Style="{StaticResource MaterialDesignRaisedButton}"
                                  Click="Generate_Click"
                                  IsEnabled="True">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="RobotExcited" Margin="0,0,8,0"/>
                                    <TextBlock Text="开始生成"/>
                                </StackPanel>
                            </Button>

                            <Button x:Name="QuickGenerateButton"
                                  Grid.Column="2"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"
                                  Click="QuickGenerate_Click"
                                  ToolTip="快速生成（使用默认设置）">
                                <materialDesign:PackIcon Kind="Flash"/>
                            </Button>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </materialDesign:Card>

            <!-- 右侧：生成结果 -->
            <materialDesign:Card Grid.Column="2" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 结果标题 -->
                    <DockPanel Grid.Row="0" Margin="0,0,0,8">
                        <TextBlock Text="生成结果"
                                 FontSize="16"
                                 FontWeight="Medium"
                                 DockPanel.Dock="Left"/>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                            <TextBlock x:Name="WordCountLabel"
                                     Text="(0字)"
                                     FontSize="14"
                                     Foreground="{DynamicResource MaterialDesignBodyLight}"
                                     Margin="0,0,8,0"/>
                            <TextBlock x:Name="QualityScoreLabel"
                                     Text=""
                                     FontSize="14"
                                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        </StackPanel>
                    </DockPanel>

                    <!-- 生成选项卡 -->
                    <TabControl Grid.Row="1" Margin="0,0,0,8" Style="{StaticResource MaterialDesignTabControl}">
                        <TabItem Header="内容">
                            <Grid Height="0"/> <!-- 占位符 -->
                        </TabItem>
                        <TabItem Header="大纲">
                            <Grid Height="0"/> <!-- 占位符 -->
                        </TabItem>
                        <TabItem Header="分析">
                            <Grid Height="0"/> <!-- 占位符 -->
                        </TabItem>
                    </TabControl>

                    <!-- 生成内容 -->
                    <Grid Grid.Row="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBox x:Name="GeneratedContentTextBox"
                               Grid.Row="0"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               TextWrapping="Wrap"
                               AcceptsReturn="True"
                               VerticalScrollBarVisibility="Auto"
                               IsReadOnly="False"
                               materialDesign:HintAssist.Hint="AI生成的章节内容将显示在这里..."
                               TextChanged="GeneratedContentTextBox_TextChanged"/>

                        <!-- 实时统计 -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock x:Name="CharacterCountLabel" Text="字符: 0" FontSize="12" Margin="0,0,16,0"/>
                            <TextBlock x:Name="ParagraphCountLabel" Text="段落: 0" FontSize="12" Margin="0,0,16,0"/>
                            <TextBlock x:Name="ReadingTimeLabel" Text="阅读时间: 0分钟" FontSize="12"/>
                        </StackPanel>
                    </Grid>

                    <!-- 操作按钮 -->
                    <StackPanel Grid.Row="3"
                              Orientation="Horizontal"
                              HorizontalAlignment="Right"
                              Margin="0,16,0,0">
                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                              Margin="0,0,8,0"
                              Click="SaveTemplate_Click"
                              ToolTip="保存为模板">
                            <materialDesign:PackIcon Kind="ContentSave"/>
                        </Button>

                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                              Margin="0,0,8,0"
                              Click="Regenerate_Click">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Refresh" Margin="0,0,4,0"/>
                                <TextBlock Text="重新生成"/>
                            </StackPanel>
                        </Button>

                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                              Margin="0,0,8,0"
                              Click="CopyToClipboard_Click">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="ContentCopy" Margin="0,0,4,0"/>
                                <TextBlock Text="复制"/>
                            </StackPanel>
                        </Button>

                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                              Margin="0,0,8,0"
                              Click="PolishContent_Click"
                              ToolTip="润色内容">
                            <materialDesign:PackIcon Kind="AutoFix"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </materialDesign:Card>
        </Grid>

        <!-- 底部按钮 -->
        <StackPanel Grid.Row="2" 
                  Orientation="Horizontal" 
                  HorizontalAlignment="Right"
                  Margin="0,24,0,0">
            <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                  Margin="0,0,8,0"
                  Click="Cancel_Click">
                <TextBlock Text="取消"/>
            </Button>
            
            <Button Style="{StaticResource MaterialDesignRaisedButton}"
                  Click="Apply_Click"
                  x:Name="ApplyButton">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Check" Margin="0,0,4,0"/>
                    <TextBlock Text="应用内容"/>
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
</Window>
