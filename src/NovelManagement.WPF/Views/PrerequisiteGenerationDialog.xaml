<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="NovelManagement.WPF.Views.PrerequisiteGenerationDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="前置条件生成" 
        Height="600" 
        Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Style="{StaticResource MaterialDesignWindow}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题和说明 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="AI编辑前置条件生成" 
                       Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,10"/>
            
            <TextBlock Text="为确保AI编辑功能正常运行，系统将检查并生成必要的前置数据，包括剧情大纲、主要角色、世界设定和势力组织。"
                       Style="{StaticResource MaterialDesignBody1TextBlock}"
                       TextWrapping="Wrap"
                       HorizontalAlignment="Center"
                       Foreground="{DynamicResource MaterialDesignBodyLight}"/>
        </StackPanel>

        <!-- 主要内容区域 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- 当前状态 -->
                <materialDesign:Card Margin="0,0,0,15" Padding="15">
                    <StackPanel>
                        <TextBlock Text="当前项目数据状态" 
                                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                   Margin="0,0,0,10"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                <TextBlock x:Name="PlotsStatusTextBlock" 
                                           Text="剧情大纲: 检查中..." 
                                           Margin="0,2"/>
                                <TextBlock x:Name="CharactersStatusTextBlock" 
                                           Text="主要角色: 检查中..." 
                                           Margin="0,2"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                <TextBlock x:Name="WorldSettingsStatusTextBlock" 
                                           Text="世界设定: 检查中..." 
                                           Margin="0,2"/>
                                <TextBlock x:Name="FactionsStatusTextBlock" 
                                           Text="势力组织: 检查中..." 
                                           Margin="0,2"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 生成选项 -->
                <materialDesign:Card Margin="0,0,0,15" Padding="15">
                    <StackPanel>
                        <TextBlock Text="生成选项"
                                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                   Margin="0,0,0,10"/>

                        <!-- 基础生成选项 -->
                        <CheckBox x:Name="GeneratePlotsCheckBox"
                                  Content="生成剧情大纲"
                                  Margin="0,5"
                                  IsChecked="True"/>

                        <CheckBox x:Name="GenerateCharactersCheckBox"
                                  Content="生成主要角色"
                                  Margin="0,5"
                                  IsChecked="True"/>

                        <CheckBox x:Name="GenerateWorldSettingsCheckBox"
                                  Content="生成世界设定"
                                  Margin="0,5"
                                  IsChecked="True"/>

                        <CheckBox x:Name="GenerateFactionsCheckBox"
                                  Content="生成势力组织"
                                  Margin="0,5"
                                  IsChecked="True"/>

                        <!-- 高级选项 -->
                        <Expander Header="高级选项" Margin="0,10,0,0">
                            <StackPanel Margin="20,10,0,0">
                                <!-- 小说类型选择 -->
                                <StackPanel Orientation="Horizontal" Margin="0,5">
                                    <TextBlock Text="小说类型:" VerticalAlignment="Center" Width="80"/>
                                    <ComboBox x:Name="NovelGenreComboBox" Width="150" SelectedIndex="0">
                                        <ComboBoxItem Content="修仙"/>
                                        <ComboBoxItem Content="都市"/>
                                        <ComboBoxItem Content="玄幻"/>
                                        <ComboBoxItem Content="科幻"/>
                                        <ComboBoxItem Content="历史"/>
                                        <ComboBoxItem Content="其他"/>
                                    </ComboBox>
                                </StackPanel>

                                <!-- 世界观风格 -->
                                <StackPanel Orientation="Horizontal" Margin="0,5">
                                    <TextBlock Text="世界观:" VerticalAlignment="Center" Width="80"/>
                                    <ComboBox x:Name="WorldStyleComboBox" Width="150" SelectedIndex="0">
                                        <ComboBoxItem Content="东方玄幻"/>
                                        <ComboBoxItem Content="西方奇幻"/>
                                        <ComboBoxItem Content="现代都市"/>
                                        <ComboBoxItem Content="未来科幻"/>
                                        <ComboBoxItem Content="古代历史"/>
                                        <ComboBoxItem Content="混合风格"/>
                                    </ComboBox>
                                </StackPanel>

                                <!-- AI生成选项 -->
                                <CheckBox x:Name="UseAIGenerationCheckBox"
                                          Content="使用AI智能生成 (更个性化)"
                                          Margin="0,10,0,5"/>

                                <TextBox x:Name="AIPromptTextBox"
                                         materialDesign:HintAssist.Hint="AI生成提示 (描述您想要的小说风格、主题等)"
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         TextWrapping="Wrap"
                                         Height="60"
                                         Margin="0,5"
                                         IsEnabled="{Binding IsChecked, ElementName=UseAIGenerationCheckBox}"/>

                                <!-- 允许后续编辑 -->
                                <CheckBox x:Name="AllowUserEditingCheckBox"
                                          Content="允许用户后续编辑和删减"
                                          Margin="0,10,0,0"
                                          IsChecked="True"/>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 生成进度 -->
                <materialDesign:Card x:Name="ProgressCard" 
                                     Margin="0,0,0,15" 
                                     Padding="15"
                                     Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="生成进度" 
                                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                   Margin="0,0,0,10"/>
                        
                        <ProgressBar x:Name="GenerationProgressBar" 
                                     Height="8" 
                                     Margin="0,0,0,10"/>
                        
                        <TextBlock x:Name="ProgressStatusTextBlock" 
                                   Text="准备开始生成..." 
                                   Style="{StaticResource MaterialDesignBody2TextBlock}"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- 生成结果 -->
                <materialDesign:Card x:Name="ResultCard" 
                                     Margin="0,0,0,15" 
                                     Padding="15"
                                     Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="生成结果" 
                                   Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                                   Margin="0,0,0,10"/>
                        
                        <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                            <TextBlock x:Name="ResultTextBlock" 
                                       TextWrapping="Wrap"
                                       Style="{StaticResource MaterialDesignBody2TextBlock}"/>
                        </ScrollViewer>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>
        </ScrollViewer>

        <!-- 操作按钮 -->
        <StackPanel Grid.Row="3" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,20,0,0">
            
            <Button x:Name="CheckStatusButton"
                    Content="检查状态"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Margin="0,0,10,0"
                    Click="CheckStatus_Click">
                <Button.ToolTip>
                    <ToolTip Content="重新检查当前项目的数据状态"/>
                </Button.ToolTip>
            </Button>
            
            <Button x:Name="GenerateButton"
                    Content="开始生成"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Margin="0,0,10,0"
                    Click="Generate_Click">
                <Button.ToolTip>
                    <ToolTip Content="根据选择的选项生成前置数据"/>
                </Button.ToolTip>
            </Button>
            
            <Button x:Name="CloseButton"
                    Content="关闭"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>
