<UserControl x:Class="NovelManagement.WPF.Views.ProjectManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1000">

    <UserControl.Resources>
        <!-- 布尔值到可见性转换器 -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- 反向布尔值到可见性转换器 -->
        <Style x:Key="InverseBooleanToVisibilityStyle" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Visible"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=DataContext.ShowRecycleBin}" Value="True">
                    <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="BooleanToVisibilityStyle" TargetType="FrameworkElement">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=DataContext.ShowRecycleBin}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 页面标题 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="项目管理" 
                     FontSize="32" 
                     FontWeight="Bold" 
                     Margin="0,0,0,8"/>
            <TextBlock Text="管理您的小说创作项目" 
                     FontSize="16" 
                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
        </StackPanel>

        <!-- 操作工具栏 -->
        <materialDesign:Card Grid.Row="1" Padding="16" Margin="0,0,0,16">
            <DockPanel>
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <Button Style="{StaticResource MaterialDesignRaisedButton}"
                            Margin="0,0,12,0"
                            Click="NewProject_Click">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Plus" Margin="0,0,8,0"/>
                            <TextBlock Text="新建项目"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="0,0,12,0"
                            Click="ImportProject_Click">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Import" Margin="0,0,8,0"/>
                            <TextBlock Text="导入项目"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="0,0,12,0"
                            Click="ExportProject_Click">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Export" Margin="0,0,8,0"/>
                            <TextBlock Text="导出项目"/>
                        </StackPanel>
                    </Button>

                    <!-- 分隔线 -->
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="12,0"/>

                    <!-- 视图切换按钮 -->
                    <Button x:Name="ShowProjectsButton"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="0,0,8,0"
                            Click="ShowProjects_Click">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Folder" Margin="0,0,8,0"/>
                            <TextBlock Text="项目列表"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="ShowRecycleBinButton"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="0,0,12,0"
                            Click="ShowRecycleBin_Click">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Delete" Margin="0,0,8,0"/>
                            <TextBlock Text="回收站"/>
                        </StackPanel>
                    </Button>

                    <!-- 回收站操作按钮 -->
                    <Button x:Name="EmptyRecycleBinButton"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Margin="0,0,12,0"
                            Click="EmptyRecycleBin_Click"
                            Visibility="Collapsed">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="DeleteEmpty" Margin="0,0,8,0"/>
                            <TextBlock Text="清空回收站"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- 搜索框 -->
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <TextBox x:Name="SearchTextBox"
                           materialDesign:HintAssist.Hint="搜索项目..."
                           ToolTip="输入关键词搜索项目"
                           materialDesign:TextFieldAssist.HasLeadingIcon="True"
                           materialDesign:TextFieldAssist.LeadingIcon="Search"
                           Width="250"
                           Margin="8,0,0,0"
                           TextChanged="SearchTextBox_TextChanged"/>
                </StackPanel>
            </DockPanel>
        </materialDesign:Card>

        <!-- 项目列表 -->
        <materialDesign:Card Grid.Row="2" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 列表标题 -->
                <Border Grid.Row="0" 
                      Background="{DynamicResource MaterialDesignDivider}" 
                      Padding="24,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="120"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="项目名称" FontWeight="Medium"/>
                        <TextBlock Grid.Column="1" Text="类型" FontWeight="Medium" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="2" Text="状态" FontWeight="Medium" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="3" Text="最后更新" FontWeight="Medium" HorizontalAlignment="Center"/>
                        <TextBlock Grid.Column="4" Text="操作" FontWeight="Medium" HorizontalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- 项目列表内容 -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="ProjectListControl">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                      BorderThickness="0,0,0,1" 
                                      Padding="24,16">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="120"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- 项目信息 -->
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" 
                                                     FontSize="16" 
                                                     FontWeight="Medium"
                                                     Margin="0,0,0,4"/>
                                            <TextBlock Text="{Binding Description}" 
                                                     Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                     TextWrapping="Wrap"/>
                                        </StackPanel>

                                        <!-- 项目类型 -->
                                        <TextBlock Grid.Column="1" 
                                                 Text="{Binding Type}" 
                                                 HorizontalAlignment="Center"
                                                 VerticalAlignment="Center"/>

                                        <!-- 项目状态 -->
                                        <materialDesign:Chip Grid.Column="2" 
                                                           Content="{Binding Status}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>

                                        <!-- 最后更新时间 -->
                                        <TextBlock Grid.Column="3" 
                                                 Text="{Binding LastUpdated}" 
                                                 HorizontalAlignment="Center"
                                                 VerticalAlignment="Center"/>

                                        <!-- 操作按钮 -->
                                        <StackPanel Grid.Column="4"
                                                  Orientation="Horizontal"
                                                  HorizontalAlignment="Center">

                                            <!-- 根据当前模式显示不同的按钮 -->
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="打开项目"
                                                  Click="OpenProject_Click"
                                                  Tag="{Binding}"
                                                  x:Name="OpenProjectButton">
                                                <materialDesign:PackIcon Kind="FolderOpen"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="编辑项目"
                                                  Click="EditProject_Click"
                                                  Tag="{Binding}"
                                                  x:Name="EditProjectButton">
                                                <materialDesign:PackIcon Kind="Edit"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="恢复项目"
                                                  Click="RestoreProject_Click"
                                                  Tag="{Binding}"
                                                  x:Name="RestoreProjectButton"
                                                  Visibility="Collapsed">
                                                <materialDesign:PackIcon Kind="Restore"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                  ToolTip="删除项目"
                                                  Click="DeleteProject_Click"
                                                  Tag="{Binding}"
                                                  x:Name="DeleteProjectButton">
                                                <materialDesign:PackIcon Kind="Delete"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </materialDesign:Card>
    </Grid>
</UserControl>
