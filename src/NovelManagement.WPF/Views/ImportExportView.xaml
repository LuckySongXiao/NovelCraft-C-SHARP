<UserControl x:Class="NovelManagement.WPF.Views.ImportExportView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             TextElement.Foreground="{DynamicResource MaterialDesignBody}"
             TextElement.FontWeight="Regular"
             TextElement.FontSize="13"
             TextOptions.TextFormattingMode="Ideal"
             TextOptions.TextRenderingMode="Auto"
             Background="{DynamicResource MaterialDesignPaper}"
             FontFamily="{DynamicResource MaterialDesignFont}">
    
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 页面标题 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="导入导出管理" 
                     FontSize="32" 
                     FontWeight="Bold" 
                     Margin="0,0,0,8"/>
            <TextBlock Text="管理项目数据的导入导出，支持多种格式和批量操作" 
                     FontSize="16" 
                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
        </StackPanel>

        <!-- 主要内容区域 -->
        <TabControl Grid.Row="1" Style="{StaticResource MaterialDesignTabControl}">
            
            <!-- 导出标签页 -->
            <TabItem Header="导出管理">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Export" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,0,8,0"/>
                            <TextBlock Text="导出管理" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>
                
                <Grid Margin="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左侧 - 导出配置 -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 导出配置面板 -->
                        <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="导出配置" 
                                         FontSize="18" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,16"/>

                                <!-- 导出格式选择 -->
                                <TextBlock Text="导出格式" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,8"/>
                                <ComboBox x:Name="ExportFormatComboBox"
                                        Style="{StaticResource MaterialDesignComboBox}"
                                        Margin="0,0,0,16"
                                        SelectedIndex="0">
                                    <ComboBoxItem Content="TXT - 纯文本格式" Tag="TXT"/>
                                    <ComboBoxItem Content="DOCX - Word文档格式" Tag="DOCX"/>
                                    <ComboBoxItem Content="PDF - PDF文档格式" Tag="PDF"/>
                                    <ComboBoxItem Content="EPUB - 电子书格式" Tag="EPUB"/>
                                    <ComboBoxItem Content="HTML - 网页格式" Tag="HTML"/>
                                    <ComboBoxItem Content="MARKDOWN - Markdown格式" Tag="MARKDOWN"/>
                                </ComboBox>

                                <!-- 导出范围选择 -->
                                <TextBlock Text="导出范围" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,8"/>
                                <ComboBox x:Name="ExportScopeComboBox"
                                        Style="{StaticResource MaterialDesignComboBox}"
                                        Margin="0,0,0,16"
                                        SelectedIndex="0"
                                        SelectionChanged="ExportScope_SelectionChanged">
                                    <ComboBoxItem Content="整个项目" Tag="EntireProject"/>
                                    <ComboBoxItem Content="选定卷宗" Tag="SelectedVolumes"/>
                                    <ComboBoxItem Content="选定章节" Tag="SelectedChapters"/>
                                    <ComboBoxItem Content="自定义范围" Tag="CustomRange"/>
                                </ComboBox>

                                <!-- 选择项目列表 -->
                                <StackPanel x:Name="SelectionPanel" Visibility="Collapsed">
                                    <TextBlock Text="选择项目" 
                                             FontWeight="Medium" 
                                             Margin="0,0,0,8"/>
                                    <ListBox x:Name="SelectionListBox" 
                                           Height="120" 
                                           SelectionMode="Multiple"
                                           Margin="0,0,0,16">
                                        <ListBoxItem Content="第一卷 - 初入仙途"/>
                                        <ListBoxItem Content="第二卷 - 风云际会"/>
                                        <ListBoxItem Content="第三卷 - 天地争锋"/>
                                    </ListBox>
                                </StackPanel>

                                <!-- 包含内容选项 -->
                                <TextBlock Text="包含内容" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,8"/>
                                <StackPanel>
                                    <CheckBox x:Name="IncludeSettingsCheckBox" 
                                            Content="设定信息" 
                                            IsChecked="True" 
                                            Margin="0,4"/>
                                    <CheckBox x:Name="IncludeCharactersCheckBox" 
                                            Content="角色信息" 
                                            IsChecked="True" 
                                            Margin="0,4"/>
                                    <CheckBox x:Name="IncludeFactionsCheckBox" 
                                            Content="势力信息" 
                                            IsChecked="True" 
                                            Margin="0,4"/>
                                    <CheckBox x:Name="IncludePlotsCheckBox" 
                                            Content="剧情信息" 
                                            IsChecked="True" 
                                            Margin="0,4"/>
                                </StackPanel>

                                <!-- 输出路径 -->
                                <TextBlock Text="输出路径" 
                                         FontWeight="Medium" 
                                         Margin="0,16,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="OutputPathTextBox" 
                                           Grid.Column="0"
                                           Style="{StaticResource MaterialDesignTextBox}"
                                           materialDesign:HintAssist.Hint="选择输出文件路径"/>
                                    <Button Grid.Column="1" 
                                          Style="{StaticResource MaterialDesignIconButton}"
                                          ToolTip="浏览文件夹"
                                          Click="BrowseOutputPath_Click"
                                          Margin="8,0,0,0">
                                        <materialDesign:PackIcon Kind="FolderOpen"/>
                                    </Button>
                                </Grid>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- 导出按钮 -->
                        <Button Grid.Row="2" 
                              Content="开始导出" 
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              Height="40"
                              Click="StartExport_Click"/>
                    </Grid>

                    <!-- 分隔符 -->
                    <GridSplitter Grid.Column="1" 
                                HorizontalAlignment="Stretch" 
                                VerticalAlignment="Stretch" 
                                Background="{DynamicResource MaterialDesignDivider}"/>

                    <!-- 右侧 - 导出进度和历史 -->
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- 当前导出进度 -->
                        <materialDesign:Card Grid.Row="0" 
                                           Padding="16" 
                                           Margin="0,0,0,16"
                                           x:Name="ExportProgressCard"
                                           Visibility="Collapsed">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <materialDesign:PackIcon Kind="Export" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                    <TextBlock Text="导出进度" 
                                             FontSize="16" 
                                             FontWeight="Medium" 
                                             VerticalAlignment="Center"/>
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                          ToolTip="取消导出"
                                          Margin="8,0,0,0"
                                          Click="CancelExport_Click">
                                        <materialDesign:PackIcon Kind="Cancel"/>
                                    </Button>
                                </StackPanel>

                                <TextBlock x:Name="ExportStatusText" 
                                         Text="准备中..." 
                                         Margin="0,0,0,8"/>
                                
                                <ProgressBar x:Name="ExportProgressBar" 
                                           Value="0" 
                                           Maximum="100" 
                                           Height="8" 
                                           Margin="0,0,0,8"/>
                                
                                <TextBlock x:Name="ExportProgressText" 
                                         Text="0 / 0 项目已处理" 
                                         FontSize="12" 
                                         Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- 导出历史记录 -->
                        <materialDesign:Card Grid.Row="1" Padding="0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 历史记录标题 -->
                                <Border Grid.Row="0" 
                                      Background="{DynamicResource MaterialDesignToolBarBackground}" 
                                      Padding="16,12">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="History" 
                                                               VerticalAlignment="Center" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="导出历史" 
                                                 FontSize="16" 
                                                 FontWeight="Medium" 
                                                 VerticalAlignment="Center"/>
                                        <Button Style="{StaticResource MaterialDesignIconButton}"
                                              ToolTip="刷新历史记录"
                                              Margin="8,0,0,0"
                                              Click="RefreshExportHistory_Click">
                                            <materialDesign:PackIcon Kind="Refresh"/>
                                        </Button>
                                    </StackPanel>
                                </Border>

                                <!-- 历史记录列表 -->
                                <ListView Grid.Row="1" 
                                        x:Name="ExportHistoryListView"
                                        ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="16,12" 
                                                  BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                                  BorderThickness="0,0,0,1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- 状态图标 -->
                                                    <materialDesign:PackIcon Grid.Column="0" 
                                                                           Kind="{Binding StatusIcon}" 
                                                                           Width="24" Height="24" 
                                                                           VerticalAlignment="Center"
                                                                           Foreground="{Binding StatusColor}"/>

                                                    <!-- 导出信息 -->
                                                    <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                                        <TextBlock Text="{Binding Format, StringFormat='格式: {0}'}" 
                                                                 FontWeight="Medium" 
                                                                 FontSize="14"/>
                                                        <TextBlock Text="{Binding FilePath}" 
                                                                 FontSize="12" 
                                                                 Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                        <TextBlock Text="{Binding StartTime, StringFormat='时间: {0:yyyy-MM-dd HH:mm}'}" 
                                                                 FontSize="11" 
                                                                 Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                        <TextBlock Text="{Binding FileSize, StringFormat='大小: {0:N0} 字节'}" 
                                                                 FontSize="11" 
                                                                 Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                    </StackPanel>

                                                    <!-- 操作按钮 -->
                                                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                                                        <Button Style="{StaticResource MaterialDesignIconButton}"
                                                              ToolTip="打开文件"
                                                              Click="OpenExportFile_Click"
                                                              Tag="{Binding}">
                                                            <materialDesign:PackIcon Kind="FileOpen"/>
                                                        </Button>
                                                        <Button Style="{StaticResource MaterialDesignIconButton}"
                                                              ToolTip="打开文件夹"
                                                              Click="OpenExportFolder_Click"
                                                              Tag="{Binding}">
                                                            <materialDesign:PackIcon Kind="FolderOpen"/>
                                                        </Button>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- 导入标签页 -->
            <TabItem Header="导入管理">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Import" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,0,8,0"/>
                            <TextBlock Text="导入管理" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>
                
                <Grid Margin="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左侧 - 导入配置 -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 导入配置面板 -->
                        <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="导入配置" 
                                         FontSize="18" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,16"/>

                                <!-- 选择文件 -->
                                <TextBlock Text="选择文件" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,8"/>
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="ImportFilePathTextBox" 
                                           Grid.Column="0"
                                           Style="{StaticResource MaterialDesignTextBox}"
                                           materialDesign:HintAssist.Hint="选择要导入的文件"/>
                                    <Button Grid.Column="1" 
                                          Style="{StaticResource MaterialDesignIconButton}"
                                          ToolTip="浏览文件"
                                          Click="BrowseImportFile_Click"
                                          Margin="8,0,0,0">
                                        <materialDesign:PackIcon Kind="FileSearch"/>
                                    </Button>
                                </Grid>

                                <!-- 文件格式 -->
                                <TextBlock Text="文件格式" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,8"/>
                                <ComboBox x:Name="ImportFormatComboBox"
                                        Style="{StaticResource MaterialDesignComboBox}"
                                        Margin="0,0,0,16"
                                        SelectedIndex="0">
                                    <ComboBoxItem Content="EXCEL - Excel表格文件" Tag="EXCEL"/>
                                    <ComboBoxItem Content="CSV - 逗号分隔值文件" Tag="CSV"/>
                                    <ComboBoxItem Content="TXT - 纯文本文件" Tag="TXT"/>
                                    <ComboBoxItem Content="JSON - JSON数据文件" Tag="JSON"/>
                                    <ComboBoxItem Content="XML - XML数据文件" Tag="XML"/>
                                </ComboBox>

                                <!-- 导入选项 -->
                                <TextBlock Text="导入选项" 
                                         FontWeight="Medium" 
                                         Margin="0,0,0,8"/>
                                <StackPanel>
                                    <CheckBox x:Name="OverwriteExistingCheckBox" 
                                            Content="覆盖现有数据" 
                                            Margin="0,4"/>
                                    <CheckBox x:Name="CreateBackupCheckBox" 
                                            Content="创建备份" 
                                            IsChecked="True" 
                                            Margin="0,4"/>
                                </StackPanel>

                                <!-- 预览按钮 -->
                                <Button Content="预览文件" 
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Margin="0,16,0,0"
                                      Click="PreviewImportFile_Click"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- 导入按钮 -->
                        <Button Grid.Row="2" 
                              Content="开始导入" 
                              Style="{StaticResource MaterialDesignRaisedButton}"
                              Height="40"
                              Click="StartImport_Click"/>
                    </Grid>

                    <!-- 分隔符 -->
                    <GridSplitter Grid.Column="1" 
                                HorizontalAlignment="Stretch" 
                                VerticalAlignment="Stretch" 
                                Background="{DynamicResource MaterialDesignDivider}"/>

                    <!-- 右侧 - 导入进度和历史 -->
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- 当前导入进度 -->
                        <materialDesign:Card Grid.Row="0" 
                                           Padding="16" 
                                           Margin="0,0,0,16"
                                           x:Name="ImportProgressCard"
                                           Visibility="Collapsed">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <materialDesign:PackIcon Kind="Import" 
                                                           VerticalAlignment="Center" 
                                                           Margin="0,0,8,0"/>
                                    <TextBlock Text="导入进度" 
                                             FontSize="16" 
                                             FontWeight="Medium" 
                                             VerticalAlignment="Center"/>
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                          ToolTip="取消导入"
                                          Margin="8,0,0,0"
                                          Click="CancelImport_Click">
                                        <materialDesign:PackIcon Kind="Cancel"/>
                                    </Button>
                                </StackPanel>

                                <TextBlock x:Name="ImportStatusText" 
                                         Text="准备中..." 
                                         Margin="0,0,0,8"/>
                                
                                <ProgressBar x:Name="ImportProgressBar" 
                                           Value="0" 
                                           Maximum="100" 
                                           Height="8" 
                                           Margin="0,0,0,8"/>
                                
                                <TextBlock x:Name="ImportProgressText" 
                                         Text="0 / 0 项目已处理" 
                                         FontSize="12" 
                                         Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- 导入历史记录 -->
                        <materialDesign:Card Grid.Row="1" Padding="0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 历史记录标题 -->
                                <Border Grid.Row="0" 
                                      Background="{DynamicResource MaterialDesignToolBarBackground}" 
                                      Padding="16,12">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="History" 
                                                               VerticalAlignment="Center" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="导入历史" 
                                                 FontSize="16" 
                                                 FontWeight="Medium" 
                                                 VerticalAlignment="Center"/>
                                        <Button Style="{StaticResource MaterialDesignIconButton}"
                                              ToolTip="刷新历史记录"
                                              Margin="8,0,0,0"
                                              Click="RefreshImportHistory_Click">
                                            <materialDesign:PackIcon Kind="Refresh"/>
                                        </Button>
                                    </StackPanel>
                                </Border>

                                <!-- 历史记录列表 -->
                                <ListView Grid.Row="1" 
                                        x:Name="ImportHistoryListView"
                                        ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="16,12" 
                                                  BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                                  BorderThickness="0,0,0,1">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- 状态图标 -->
                                                    <materialDesign:PackIcon Grid.Column="0" 
                                                                           Kind="{Binding StatusIcon}" 
                                                                           Width="24" Height="24" 
                                                                           VerticalAlignment="Center"
                                                                           Foreground="{Binding StatusColor}"/>

                                                    <!-- 导入信息 -->
                                                    <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                                        <TextBlock Text="{Binding Format, StringFormat='格式: {0}'}" 
                                                                 FontWeight="Medium" 
                                                                 FontSize="14"/>
                                                        <TextBlock Text="{Binding FilePath}" 
                                                                 FontSize="12" 
                                                                 Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                        <TextBlock Text="{Binding StartTime, StringFormat='时间: {0:yyyy-MM-dd HH:mm}'}" 
                                                                 FontSize="11" 
                                                                 Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                        <TextBlock Text="{Binding FileSize, StringFormat='大小: {0:N0} 字节'}" 
                                                                 FontSize="11" 
                                                                 Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                    </StackPanel>

                                                    <!-- 操作按钮 -->
                                                    <Button Grid.Column="2" 
                                                          Style="{StaticResource MaterialDesignIconButton}"
                                                          ToolTip="查看详情"
                                                          Click="ViewImportDetails_Click"
                                                          Tag="{Binding}">
                                                        <materialDesign:PackIcon Kind="Information"/>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
