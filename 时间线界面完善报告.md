# æ—¶é—´çº¿ç•Œé¢å®Œå–„æŠ¥å‘Š

## ğŸ“‹ å®Œå–„ç›®æ ‡

åŸºäºå…¶ä»–è®¾å®šç•Œé¢çš„æœ€ä½³å®è·µï¼Œå®Œå–„æ—¶é—´çº¿ç•Œé¢çš„é¢„è§ˆå’Œäº¤äº’åŠŸèƒ½ï¼Œæä¾›æ›´ä¸“ä¸šå’Œä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ” å…¶ä»–ç•Œé¢åˆ†æ

### 1. åŠ¿åŠ›ç®¡ç†ç•Œé¢ (FactionManagementView)
**ç‰¹ç‚¹**:
- ä½¿ç”¨ **Commandæ¨¡å¼** + MouseBinding
- å·¦ä¾§åˆ—è¡¨ + å³ä¾§è¯¦æƒ…çš„ç»å…¸å¸ƒå±€
- å³ä¾§é»˜è®¤æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- ä½¿ç”¨ `SelectFactionCommand` å¤„ç†é€‰æ‹©äº‹ä»¶

**XAMLç»“æ„**:
```xml
<Border.InputBindings>
    <MouseBinding MouseAction="LeftClick" 
                Command="{Binding DataContext.SelectFactionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}"/>
</Border.InputBindings>
```

### 2. ä¿®ç‚¼ä½“ç³»ç•Œé¢ (CultivationSystemView)
**ç‰¹ç‚¹**:
- ä½¿ç”¨ **ListView + SelectionChanged** æ¨¡å¼
- åŠ¨æ€ç”Ÿæˆè¯¦æƒ…ç¼–è¾‘é¢æ¿
- å®Œæ•´çš„CRUDæ“ä½œæ”¯æŒ
- ç»Ÿè®¡ä¿¡æ¯å®æ—¶æ›´æ–°

**XAMLç»“æ„**:
```xml
<ListView x:Name="CultivationListControl"
         SelectionMode="Single"
         SelectionChanged="CultivationList_SelectionChanged">
```

### 3. å‰§æƒ…ç®¡ç†ç•Œé¢ (PlotManagementView)
**ç‰¹ç‚¹**:
- ä¸°å¯Œçš„ç»Ÿè®¡ä¿¡æ¯å±•ç¤º
- æœ€è¿‘æ›´æ–°äº‹ä»¶æ˜¾ç¤º
- è¿›åº¦æ¡å’ŒçŠ¶æ€åˆ†å¸ƒ
- ç¾è§‚çš„å¡ç‰‡å¼å¸ƒå±€

## âœ… æ—¶é—´çº¿ç•Œé¢å®Œå–„æ–¹æ¡ˆ

### 1. é‡‡ç”¨ListView + SelectionChangedæ¨¡å¼
**åŸå› **: æ›´æ ‡å‡†ã€æ›´å¯é çš„WPFé€‰æ‹©æœºåˆ¶

**å®ç°**:
```xml
<ListView x:Name="TimelineListControl"
        SelectionMode="Single"
        SelectionChanged="TimelineList_SelectionChanged"
        ScrollViewer.HorizontalScrollBarVisibility="Disabled"
        ScrollViewer.VerticalScrollBarVisibility="Auto">
    <ListView.ItemContainerStyle>
        <Style TargetType="ListViewItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
    </ListView.ItemContainerStyle>
</ListView>
```

### 2. ç®€åŒ–äº‹ä»¶å¤„ç†é€»è¾‘
**ç§»é™¤å¤æ‚çš„Buttonäº‹ä»¶å¤„ç†**:
- ç§»é™¤ `Click="TimelineEvent_Click"`
- ç§»é™¤ `PreviewMouseLeftButtonDown="TimelineEvent_PreviewMouseDown"`
- ç§»é™¤ `MouseUp="TimelineEvent_MouseUp"`

**é‡‡ç”¨ç®€å•çš„Gridå®¹å™¨**:
```xml
<Grid Cursor="Hand">
    <!-- äº‹ä»¶å†…å®¹ -->
</Grid>
```

### 3. å¢å¼ºç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
**å‚è€ƒå‰§æƒ…ç®¡ç†ç•Œé¢ï¼Œæ·»åŠ ä¸°å¯Œçš„ç»Ÿè®¡ä¿¡æ¯**:

```xml
<!-- ç»Ÿè®¡å¡ç‰‡ -->
<UniformGrid Columns="2" Margin="0,0,0,24">
    <materialDesign:Card Margin="0,0,8,8" Padding="16">
        <StackPanel>
            <TextBlock Text="æ€»äº‹ä»¶æ•°" FontSize="14" 
                     Foreground="{DynamicResource MaterialDesignBodyLight}"/>
            <TextBlock x:Name="TotalEventsText" Text="0" 
                     FontSize="32" FontWeight="Bold"/>
        </StackPanel>
    </materialDesign:Card>
    <!-- æ›´å¤šç»Ÿè®¡å¡ç‰‡... -->
</UniformGrid>
```

### 4. æ·»åŠ äº‹ä»¶çŠ¶æ€åˆ†å¸ƒ
**è¿›åº¦æ¡æ˜¾ç¤ºå„çŠ¶æ€äº‹ä»¶æ•°é‡**:
```xml
<Grid Margin="0,0,0,8">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
    </Grid.ColumnDefinitions>
    
    <materialDesign:Chip Grid.Column="0" Content="å·²å®Œæˆ" 
                       Margin="0,0,12,0" Background="#4CAF50"/>
    <ProgressBar Grid.Column="1" x:Name="CompletedProgressBar" 
               Maximum="100" VerticalAlignment="Center"/>
    <TextBlock Grid.Column="2" x:Name="CompletedCountText" 
             Text="0" VerticalAlignment="Center" Margin="8,0,0,0"/>
</Grid>
```

### 5. æœ€è¿‘äº‹ä»¶åŠ¨æ€æ˜¾ç¤º
**åŠ¨æ€ç”Ÿæˆæœ€è¿‘äº‹ä»¶åˆ—è¡¨**:
```csharp
private void UpdateRecentEvents()
{
    var recentEvents = TimelineEvents
        .OrderByDescending(e => e.CreatedAt)
        .Take(3)
        .ToList();

    foreach (var evt in recentEvents)
    {
        // åŠ¨æ€åˆ›å»ºUIå…ƒç´ æ˜¾ç¤ºäº‹ä»¶ä¿¡æ¯
    }
}
```

## ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. ListViewé€‰æ‹©äº‹ä»¶å¤„ç†
```csharp
private void TimelineList_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    try
    {
        if (TimelineListControl.SelectedItem is TimelineEventViewModel selectedEvent)
        {
            System.Diagnostics.Debug.WriteLine($"ListViewé€‰æ‹©äº‹ä»¶: {selectedEvent.Title}");
            SelectTimelineEvent(selectedEvent);
        }
    }
    catch (Exception ex)
    {
        System.Diagnostics.Debug.WriteLine($"TimelineList_SelectionChangedå¼‚å¸¸: {ex.Message}");
        MessageBox.Show($"é€‰æ‹©äº‹ä»¶å¤±è´¥ï¼š{ex.Message}", "é”™è¯¯", MessageBoxButton.OK, MessageBoxImage.Error);
    }
}
```

### 2. ç»Ÿè®¡ä¿¡æ¯å®æ—¶æ›´æ–°
```csharp
private void UpdateStatistics()
{
    var totalCount = TimelineEvents.Count;
    var historyCount = TimelineEvents.Count(e => e.Category == "å†å²äº‹ä»¶");
    var plotCount = TimelineEvents.Count(e => e.Category == "å‰§æƒ…äº‹ä»¶");
    var characterCount = TimelineEvents.Count(e => e.Category == "è§’è‰²äº‹ä»¶");

    // çŠ¶æ€ç»Ÿè®¡
    var completedCount = TimelineEvents.Count(e => e.Status == "å·²å®Œæˆ");
    var inProgressCount = TimelineEvents.Count(e => e.Status == "è¿›è¡Œä¸­");
    var plannedCount = TimelineEvents.Count(e => e.Status == "è®¡åˆ’ä¸­");

    // æ›´æ–°UIæ˜¾ç¤º
    UpdateStatisticsUI(totalCount, historyCount, plotCount, characterCount, 
                     completedCount, inProgressCount, plannedCount);
    UpdateRecentEvents();
}
```

### 3. UIå…ƒç´ åŠ¨æ€æ›´æ–°
```csharp
private void UpdateStatisticsUI(int total, int history, int plot, int character,
                               int completed, int inProgress, int planned)
{
    // æ›´æ–°æ•°é‡æ˜¾ç¤º
    if (TotalEventsText != null) TotalEventsText.Text = total.ToString();
    if (HistoryEventsText != null) HistoryEventsText.Text = history.ToString();
    if (PlotEventsText != null) PlotEventsText.Text = plot.ToString();
    if (CharacterEventsText != null) CharacterEventsText.Text = character.ToString();

    // æ›´æ–°çŠ¶æ€è¿›åº¦æ¡
    if (total > 0)
    {
        if (CompletedProgressBar != null) 
            CompletedProgressBar.Value = (double)completed / total * 100;
        if (InProgressProgressBar != null) 
            InProgressProgressBar.Value = (double)inProgress / total * 100;
        if (PlannedProgressBar != null) 
            PlannedProgressBar.Value = (double)planned / total * 100;
    }
}
```

### 4. ç›¸å¯¹æ—¶é—´æ˜¾ç¤º
```csharp
private string GetRelativeTime(DateTime dateTime)
{
    var timeSpan = DateTime.Now - dateTime;
    
    if (timeSpan.TotalMinutes < 1)
        return "åˆšåˆš";
    else if (timeSpan.TotalHours < 1)
        return $"{(int)timeSpan.TotalMinutes}åˆ†é’Ÿå‰";
    else if (timeSpan.TotalDays < 1)
        return $"{(int)timeSpan.TotalHours}å°æ—¶å‰";
    else if (timeSpan.TotalDays < 7)
        return $"{(int)timeSpan.TotalDays}å¤©å‰";
    else
        return dateTime.ToString("MMæœˆddæ—¥");
}
```

## ğŸ“Š å®Œå–„æ•ˆæœ

### ç¼–è¯‘çŠ¶æ€
- âœ… **0ä¸ªé”™è¯¯** - ç¼–è¯‘å®Œå…¨æˆåŠŸ
- âš ï¸ 1216ä¸ªè­¦å‘Š - ä¸»è¦æ˜¯XMLæ³¨é‡Šç¼ºå¤±ï¼Œä¸å½±å“åŠŸèƒ½
- âœ… **æ„å»ºé€šè¿‡** - æ‰€æœ‰é¡¹ç›®æ­£å¸¸ç¼–è¯‘

### åŠŸèƒ½å®Œå–„æ¸…å•
- âœ… **æ ‡å‡†åŒ–é€‰æ‹©æœºåˆ¶** - é‡‡ç”¨ListView + SelectionChanged
- âœ… **ç®€åŒ–äº‹ä»¶å¤„ç†** - ç§»é™¤å¤æ‚çš„Buttonäº‹ä»¶å¤„ç†
- âœ… **ä¸°å¯Œç»Ÿè®¡ä¿¡æ¯** - æ€»æ•°ã€åˆ†ç±»ã€çŠ¶æ€åˆ†å¸ƒ
- âœ… **åŠ¨æ€è¿›åº¦æ¡** - å®æ—¶æ˜¾ç¤ºå„çŠ¶æ€äº‹ä»¶æ¯”ä¾‹
- âœ… **æœ€è¿‘äº‹ä»¶æ˜¾ç¤º** - åŠ¨æ€ç”Ÿæˆæœ€è¿‘3ä¸ªäº‹ä»¶
- âœ… **ç›¸å¯¹æ—¶é—´æ˜¾ç¤º** - äººæ€§åŒ–çš„æ—¶é—´æ˜¾ç¤º
- âœ… **å®æ—¶æ•°æ®æ›´æ–°** - ç»Ÿè®¡ä¿¡æ¯è‡ªåŠ¨åˆ·æ–°

### ç”¨æˆ·ä½“éªŒæå‡
- âœ… **ä¸€è‡´çš„äº¤äº’æ¨¡å¼** - ä¸å…¶ä»–ç•Œé¢ä¿æŒä¸€è‡´
- âœ… **ä¸°å¯Œçš„ä¿¡æ¯å±•ç¤º** - ç»Ÿè®¡æ•°æ®ä¸€ç›®äº†ç„¶
- âœ… **ç›´è§‚çš„çŠ¶æ€æ˜¾ç¤º** - è¿›åº¦æ¡å’Œé¢œè‰²ç¼–ç 
- âœ… **ä¾¿æ·çš„æœ€è¿‘è®¿é—®** - å¿«é€ŸæŸ¥çœ‹æœ€æ–°äº‹ä»¶
- âœ… **ä¸“ä¸šçš„ç•Œé¢è®¾è®¡** - Material Designé£æ ¼

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. æ ‡å‡†åŒ–æ¶æ„
- **ListViewæ¨¡å¼**: é‡‡ç”¨WPFæ ‡å‡†çš„ListViewæ§ä»¶
- **SelectionChanged**: ä½¿ç”¨æ ‡å‡†çš„é€‰æ‹©å˜åŒ–äº‹ä»¶
- **æ•°æ®ç»‘å®š**: å®Œæ•´çš„MVVMæ•°æ®ç»‘å®šæ”¯æŒ

### 2. åŠ¨æ€UIç”Ÿæˆ
- **ç»Ÿè®¡ä¿¡æ¯**: å®æ—¶è®¡ç®—å’Œæ˜¾ç¤ºç»Ÿè®¡æ•°æ®
- **è¿›åº¦æ¡**: åŠ¨æ€æ›´æ–°çŠ¶æ€åˆ†å¸ƒè¿›åº¦æ¡
- **æœ€è¿‘äº‹ä»¶**: åŠ¨æ€ç”Ÿæˆæœ€è¿‘äº‹ä»¶UIå…ƒç´ 

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **ç›¸å¯¹æ—¶é—´**: äººæ€§åŒ–çš„æ—¶é—´æ˜¾ç¤ºæ–¹å¼
- **é¢œè‰²ç¼–ç **: ç›´è§‚çš„çŠ¶æ€å’Œé‡è¦ç¨‹åº¦æ˜¾ç¤º
- **å“åº”å¼å¸ƒå±€**: é€‚åº”ä¸åŒçª—å£å¤§å°

### 4. ä»£ç è´¨é‡
- **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯
- **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„æ•°æ®æŸ¥è¯¢å’ŒUIæ›´æ–°
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ³¨é‡Š

## ğŸš€ æœ€ç»ˆæ•ˆæœ

### ç•Œé¢ç»Ÿä¸€æ€§
- âŒ **å®Œå–„å‰**: ä¸å…¶ä»–ç•Œé¢äº¤äº’æ–¹å¼ä¸ä¸€è‡´
- âœ… **å®Œå–„å**: é‡‡ç”¨æ ‡å‡†ListViewæ¨¡å¼ï¼Œä¸ç³»ç»Ÿå…¶ä»–ç•Œé¢ä¿æŒä¸€è‡´

### ä¿¡æ¯ä¸°å¯Œåº¦
- âŒ **å®Œå–„å‰**: å³ä¾§åªæœ‰ç®€å•çš„æç¤ºä¿¡æ¯
- âœ… **å®Œå–„å**: ä¸°å¯Œçš„ç»Ÿè®¡ä¿¡æ¯ã€çŠ¶æ€åˆ†å¸ƒã€æœ€è¿‘äº‹ä»¶

### äº¤äº’å¯é æ€§
- âŒ **å®Œå–„å‰**: å¤æ‚çš„Buttonäº‹ä»¶å¤„ç†ï¼Œå®¹æ˜“å‡ºç°é—®é¢˜
- âœ… **å®Œå–„å**: æ ‡å‡†çš„ListViewé€‰æ‹©æœºåˆ¶ï¼Œç¨³å®šå¯é 

### ä¸“ä¸šç¨‹åº¦
- âŒ **å®Œå–„å‰**: åŠŸèƒ½ç®€å•ï¼Œç¼ºä¹ä¸“ä¸šæ„Ÿ
- âœ… **å®Œå–„å**: å®Œæ•´çš„ç»Ÿè®¡åˆ†æï¼Œä¸“ä¸šçš„æ•°æ®å±•ç¤º

**æ—¶é—´çº¿ç•Œé¢ç°å·²å®Œå…¨æŒ‰ç…§ç³»ç»Ÿå…¶ä»–ç•Œé¢çš„æœ€ä½³å®è·µè¿›è¡Œå®Œå–„ï¼Œæä¾›äº†ä¸“ä¸šã€ä¸€è‡´ã€ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒï¼**
